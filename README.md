# ChatGPT 公式剪贴板自动格式化工具

[English Version](./README_EN.md)

这是一个基于 Python 的实时剪贴板监听工具，专门用于修复从 ChatGPT 复制出来的 LaTeX 公式格式问题。它可以自动将 ChatGPT 常见的块级公式标记 `[` ... `]` 转换为标准的 `$$ ... $$` 格式，并处理行内公式和多余空行。

## 核心功能

- **🚀 实时监听**：后台自动监控剪贴板变化，发现匹配内容即刻秒速转换。
- **📝 公式块转换**：自动将 `[` ... `]` 标记包裹的公式块转换为单行 `$$ ... $$` 格式。
- **🔗 行内公式处理**：智能识别 `(...)` 中的 LaTeX 内容（如带有 `\`, `^`, `_` 等符号）并转换为 `$$ ... $$`。
- **🛡️ 嵌套括号支持**：完美处理如 `(d_k(w))` 这样带有嵌套括号的复杂数学表达式。
- **📦 引用块支持**：支持处理 ChatGPT 回复中带有 `>` 引用符号的公式块。
- **🧹 极致清理**：
    - **自动合并多行公式**：将分散在多行的复杂公式块合并为一行。
    - **完全消除空行**：移除文本中所有无用的空行，使输出内容紧凑整洁。
- **🔒 安全保护**：内置公式保护机制，防止已经转换好的公式被二次错误处理。

## 安装要求

在使用之前，请确保已安装 `pyperclip` 库，用于剪贴板操作：

```bash
pip install pyperclip
```

## 使用方法

1. **启动脚本**：
   在终端运行：
   ```bash
   python format_formulas.py
   ```
2. **复制内容**：
   在浏览器中直接复制 ChatGPT 的回复内容。
3. **自动转换**：
   脚本检测到变化后会立即在后台完成转换，并更新你的剪贴板。
4. **粘贴使用**：
   直接在你的编辑器或文档中粘贴，你会发现所有的公式都已经修复为标准的 LaTeX 格式。

## 示例

### 输入（ChatGPT 原始格式）：
```text
* 全局目标：
  [
  \min_w F(w) \triangleq \sum_{k=1}^K \frac{n_k}{n} G_k(w)
  ]

  其中 (\gamma_k^t) 是参数。
```

### 输出（工具处理后）：
```text
* 全局目标：
  $$ \min_w F(w) \triangleq \sum_{k=1}^K \frac{n_k}{n} G_k(w) $$
  其中 $$ \gamma_k^t $$ 是参数。
```

## 注意事项

- **退出程序**：在终端按 `Ctrl + C` 即可停止监听。
- **权限说明**：在某些操作系统上，确保终端有权限访问剪贴板。
- **重启生效**：如果你修改了 `format_formulas.py` 的代码，需要重启脚本才能应用新逻辑。
